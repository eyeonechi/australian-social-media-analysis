<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset= "UTF-8" />
	<title>Australian Map of Foods</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" type="text/javascript"></script>
	<script type ="text/javascript" src="/js/Couch.js"></script>
	<script src='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.js'></script>
	<link href='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.css' rel='stylesheet' />
	<style>
		body {
		  margin: 0;
		  padding :0;
		}
		.map {
		  position: absolute;
		  top: 0;
		  bottom: 0;
		  width: 100%;
		}
	</style>
</head>
<body>
<!--map container-->
<div id='map-leaflet' class='map'> </div>
<!--end map container-->
<script>
//map initiation
	L.mapbox.accessToken = 'pk.eyJ1IjoiaGFubmFobmdvYyIsImEiOiJjamc3Z2ZldDUwMjc4Mndwam9wZWNqZG5rIn0.Qj8OvcCuEytwM9tAXakxpQ';
	var mapLeaflet = L.mapbox.map('map-leaflet', 'mapbox.streets')
	  .setView([-37.814, 144.96332], 5);
//end map initiation

//set marker icon
var redIcon = L.icon({
    iconUrl: '/images/redDot.png',
    iconSize:     [10, 10], // size of the icon
});
var yellowIcon = L.icon({
    iconUrl: '/images/yellowDot.png',
    iconSize:     [10, 10], // size of the icon
});
var greenIcon = L.icon({
    iconUrl: '/images/greenDot.png',
    iconSize:     [10, 10], // size of the icon
});
var blueIcon = L.icon({
    iconUrl: '/images/blueDot.png',
    iconSize:     [10, 10], // size of the icon
});
var purpleIcon = L.icon({
    iconUrl: '/images/purpleDot.png',
    iconSize:     [10, 10], // size of the icon
});
var darkgreenIcon = L.icon({
    iconUrl: '/images/greendarkDot.png',
    iconSize:     [10, 10], // size of the icon
});
//end marker

//image marker
var meatIcon = L.icon({
    iconUrl: '/images/googleIcons/ms_steak.png',
    iconSize:     [30, 30], // size of the icon
});
var fastfoodIcon = L.icon({
    iconUrl: '/images/googleIcons/ms_pizza.png',
    iconSize:     [30, 30], // size of the icon
});
var fruitIcon = L.icon({
    iconUrl: '/images/googleIcons/ms_strawberry.png',
    iconSize:     [30, 30], // size of the icon
});
var vegIcon = L.icon({
    iconUrl: '/images/googleIcons/ms_broccoli.png',
    iconSize:     [30, 30], // size of the icon
});
var seafoodIcon = L.icon({
    iconUrl: '/images/googleIcons/crab.png',
    iconSize:     [30, 30], // size of the icon
});
var grainIcon = L.icon({
    iconUrl: '/images/googleIcons/corn.png',
    iconSize:     [30, 30], // size of the icon
});
//end image

//get data from server  
	var couch = new Couch();
	var db_name = "test000";
	var result = couch.query_all(db_name);
	var marker, color;
	if(result === undefined) {
		console.log("Cannot GET data from: " +db_name);
	} else {
		//console.log(result.data[0].features);
		result.data[0].features.forEach(function(point) {
			console.log(point.properties.food);
			if (point.properties.food === 'pizza') {
				color = fastfoodIcon;
			} else {
				color = vegIcon;
			}
			marker = L.marker(point.geometry.coordinates,{
				icon: color
			}).addTo(mapLeaflet);
			marker.bindPopup(JSON.stringify(point.properties));
		});
	}
	/*
	map.on('zoomend', function() {
		var currentZoom = map.getZoom();
		if (currentZoom > 12) {
			all_testptLayer.eachLayer(function(layer) {
				if (layer.feature.properties.num < 0.5)
					return layer.setIcon(ar_icon_1);
				else if (feature.properties.num < 1.0)
					return layer.setIcon(ar_icon_2);
			});
		} else {
			all_testptLayer.eachLayer(function(layer) {
				if (layer.feature.properties.num < 0.5)
					return layer.setIcon(ar_icon_1_double_size);
				else if (feature.properties.num < 1.0)
					return layer.setIcon(ar_icon_2_double_size);
			});
		}
	}*/
</script>
</body>
</html>